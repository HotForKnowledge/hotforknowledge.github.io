<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>How to write the simplest trading strategy using Spreads &middot; Victor Baybekov</title>
        <meta name="description" content="I am always amused when retail traders are offered and then do use black boxes with complex frameworks to build automatic trading strategies. Usually, that goes with an explanation how cool those platforms are and how easy to build a strategy using them. They forget about vendor lock-in and the most terrible model of shared state with events hell like &ldquo;OnData&rdquo;, &ldquo;OnOrder&rdquo;, &ldquo;OnBarOpen&rdquo;, &ldquo;OnBarClose&rdquo;, etc. The more I talk with people, the more I realize that CEP is the approach that desks and serious traders use.">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="generator" content="Hugo 0.17" />
        <meta name="robots" content="index,follow">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta property="og:title" content="How to write the simplest trading strategy using Spreads">
<meta property="og:description" content="I am always amused when retail traders are offered and then do use black boxes with complex frameworks to build automatic trading strategies. Usually, that goes with an explanation how cool those platforms are and how easy to build a strategy using them. They forget about vendor lock-in and the most terrible model of shared state with events hell like &ldquo;OnData&rdquo;, &ldquo;OnOrder&rdquo;, &ldquo;OnBarOpen&rdquo;, &ldquo;OnBarClose&rdquo;, etc. The more I talk with people, the more I realize that CEP is the approach that desks and serious traders use.">
<meta property="og:type" content="article">
<meta property="og:url" content="http://hotforknowledge.com/2015/12/29/2-how-to-write-the-simplest-trading-strategy-using-spreads/">
        <link rel="stylesheet" href="http://hotforknowledge.com/css/normalize.css">
        <link rel="stylesheet" href="http://hotforknowledge.com/css/highlight.css">
        <link rel="stylesheet" href="http://hotforknowledge.com/css/style.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
        <link rel="icon" href="http://hotforknowledge.com/favicon.png?v=1" />
    </head>
    <body>
        
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-66650797-1', 'auto');
ga('send', 'pageview');
</script>


        <div id="wrapper">
            <header class="site-header">
                <div class="container">
                    <ul class="site-nav">
                        
    <li class="site-nav-item">
        <a title="Blog" href="/">Blog</a>
    </li>

    <li class="site-nav-item">
        <a title="About" href="/about">About</a>
    </li>

    <li class="site-nav-item">
        <a title="Contact" href="#footer">Contact</a>
    </li>

                    </ul>
                </div>
            </header>

            <div id="container">


<div class="container">
    <article class="post-container" itemscope="" itemtype="http://schema.org/BlogPosting">
        <header class="post-header">
    <h1 class="post-title" itemprop="name headline">How to write the simplest trading strategy using Spreads</h1>
    
    <p class="post-date">
        <span>Published <time datetime="2015-12-29" itemprop="datePublished">Tue, Dec 29, 2015</time></span>
        <span>by</span>
        <span itemscope="" itemprop="author" itemtype="http://schema.org/Person">
            <span itemprop="name">
                <a href="https://twitter.com/buybackoff/" itemprop="url" rel="author">Victor Baybekov</a>
            </span>
        </span>
    </p>
</header>

        <div class="post-content clearfix" itemprop="articleBody">
    

    <p>I am always amused when retail traders are offered and then do use black boxes with complex frameworks to build automatic trading strategies. Usually, that goes with an explanation how cool those platforms are and how easy to build a strategy using them. They forget about vendor lock-in and the most terrible model of <em>shared state with events hell</em> like &ldquo;OnData&rdquo;, &ldquo;OnOrder&rdquo;, &ldquo;OnBarOpen&rdquo;, &ldquo;OnBarClose&rdquo;, etc. The more I talk with people, the more I realize that <strong><a href="https://en.wikipedia.org/wiki/Complex_event_processing">CEP</a></strong> is the approach that desks and serious traders use.</p>

<p>Spreads is not a framework for financial markets but a generic CEP library that allows to model markets as <em>data series</em> and use pure math and functional data transformations.</p>

<p>The simplest trivial example is <em>simple moving average </em>trend following strategy. This example is written in F# interactive console.  First, we generate trending artificial data where trend changes each 40 points:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">let</span> <span style="color: #f8f8f2">quotes</span> <span style="color: #f92672">:</span> <span style="color: #f8f8f2">Series</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">DateTime</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">float</span><span style="color: #f92672">&gt;</span> <span style="color: #f92672">=</span> <span style="color: #75715e">// data is produced outside</span>
    <span style="color: #66d9ef">let</span> <span style="color: #f8f8f2">mutable</span> <span style="color: #f8f8f2">previous</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #ae81ff">0</span>
    <span style="color: #66d9ef">let</span> <span style="color: #f8f8f2">sm</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">SortedMap()</span>
    <span style="color: #66d9ef">let</span> <span style="color: #f8f8f2">now</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">DateTime.UtcNow</span>
    <span style="color: #66d9ef">let</span> <span style="color: #f8f8f2">mutable</span> <span style="color: #f8f8f2">trend</span> <span style="color: #f92672">=</span> <span style="color: #f92672">-</span><span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #ae81ff">0</span>
    <span style="color: #66d9ef">let</span> <span style="color: #f8f8f2">mutable</span> <span style="color: #f8f8f2">cnt</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span>
    <span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">i</span> <span style="color: #66d9ef">in</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">..</span><span style="color: #ae81ff">500</span> <span style="color: #66d9ef">do</span>
      <span style="color: #f8f8f2">previous</span> <span style="color: #f92672">&lt;-</span> <span style="color: #f8f8f2">previous</span><span style="color: #f92672">*(</span><span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #ae81ff">0</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">rng</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">NextDouble()</span><span style="color: #f92672">*</span><span style="color: #ae81ff">0</span><span style="color: #f92672">.</span><span style="color: #ae81ff">002</span> <span style="color: #f92672">-</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">.</span><span style="color: #ae81ff">001</span> <span style="color: #f92672">+</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">.</span><span style="color: #ae81ff">001</span> <span style="color: #f92672">*</span> <span style="color: #f8f8f2">trend</span><span style="color: #f92672">)</span>
      <span style="color: #f8f8f2">sm</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Add</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">now</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">AddSeconds</span><span style="color: #f92672">(-((</span><span style="color: #ae81ff">500</span><span style="color: #f92672">-</span><span style="color: #f8f8f2">i</span><span style="color: #f92672">)</span> <span style="color: #f92672">|&gt;</span> <span style="color: #66d9ef">float</span><span style="color: #f92672">)*</span><span style="color: #ae81ff">0</span><span style="color: #f92672">.</span><span style="color: #ae81ff">2</span><span style="color: #f92672">),</span> <span style="color: #f8f8f2">previous</span><span style="color: #f92672">)</span>
      <span style="color: #f8f8f2">cnt</span> <span style="color: #f92672">&lt;-</span> <span style="color: #f8f8f2">cnt</span> <span style="color: #f92672">+</span> <span style="color: #ae81ff">1</span>
      <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">cnt</span> <span style="color: #f92672">%</span> <span style="color: #ae81ff">40</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span> <span style="color: #66d9ef">then</span> <span style="color: #f8f8f2">trend</span> <span style="color: #f92672">&lt;-</span> <span style="color: #f92672">-</span><span style="color: #f8f8f2">trend</span>

    <span style="color: #f8f8f2">Task.Run</span><span style="color: #f92672">((</span><span style="color: #66d9ef">fun</span> <span style="color: #f92672">_</span> <span style="color: #f92672">-&gt;</span>
        
        <span style="color: #66d9ef">while</span> <span style="color: #f92672">not</span> <span style="color: #f8f8f2">ct</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">IsCancellationRequested</span> <span style="color: #66d9ef">do</span>
          <span style="color: #f8f8f2">Thread.Sleep</span><span style="color: #f92672">(</span><span style="color: #ae81ff">500</span><span style="color: #f92672">)</span>
          <span style="color: #f8f8f2">previous</span> <span style="color: #f92672">&lt;-</span> <span style="color: #f8f8f2">previous</span><span style="color: #f92672">*(</span><span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #ae81ff">0</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">rng</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">NextDouble()</span><span style="color: #f92672">*</span><span style="color: #ae81ff">0</span><span style="color: #f92672">.</span><span style="color: #ae81ff">002</span> <span style="color: #f92672">-</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">.</span><span style="color: #ae81ff">001</span> <span style="color: #f92672">+</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">.</span><span style="color: #ae81ff">001</span> <span style="color: #f92672">*</span> <span style="color: #f8f8f2">trend</span><span style="color: #f92672">)</span>
          <span style="color: #f8f8f2">sm</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Add</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">DateTime.UtcNow</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">previous</span><span style="color: #f92672">)</span>
          <span style="color: #f8f8f2">cnt</span> <span style="color: #f92672">&lt;-</span> <span style="color: #f8f8f2">cnt</span> <span style="color: #f92672">+</span> <span style="color: #ae81ff">1</span>
          <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">cnt</span> <span style="color: #f92672">%</span> <span style="color: #ae81ff">40</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span> <span style="color: #66d9ef">then</span> <span style="color: #f8f8f2">trend</span> <span style="color: #f92672">&lt;-</span> <span style="color: #f92672">-</span><span style="color: #f8f8f2">trend</span>
      <span style="color: #f92672">),</span> <span style="color: #f8f8f2">ct</span><span style="color: #f92672">)</span> <span style="color: #f92672">|&gt;</span> <span style="color: #f8f8f2">ignore</span>
    <span style="color: #f8f8f2">sm</span> <span style="color: #f92672">:&gt;</span> <span style="color: #f8f8f2">Series</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">DateTime</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">float</span><span style="color: #f92672">&gt;</span>
</pre></div>

<p>Then we calculate simple moving average over 20 points. The second argument allows using incomplete windows, i.e. calculating the average over the first 1, 2, &hellip; 19 data points. With false, the first SMA point is calculated only at the 20th quotes point.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">let</span> <span style="color: #f8f8f2">sma</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">quotes</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">SMA</span><span style="color: #f92672">(</span><span style="color: #ae81ff">20</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">true</span><span style="color: #f92672">)</span>
</pre></div>

<p>Our trading rule is that if the current price is above SMA, we go long, and we go short otherwise. This is a classic trend-following strategy and it works quite well in the long run on emerging markets and some commodities. We calculate our target position as:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">let</span> <span style="color: #f8f8f2">targetPosition</span> <span style="color: #f92672">=</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">quotes</span> <span style="color: #f92672">/</span> <span style="color: #f8f8f2">sma</span> <span style="color: #f92672">-</span> <span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #ae81ff">0</span><span style="color: #f92672">).</span><span style="color: #f8f8f2">Map</span><span style="color: #f92672">(</span><span style="color: #66d9ef">fun</span> <span style="color: #f8f8f2">deviation</span> <span style="color: #f92672">-&gt;</span> <span style="color: #66d9ef">double</span> <span style="color: #f92672">&lt;|</span> <span style="color: #f8f8f2">Math.Sign</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">deviation</span><span style="color: #f92672">))</span>
</pre></div>

<p>This target position series is live - its values are updated in real-time together with quotes. To execute our strategy, we must prepare storage for actual positions and trades:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">// we must keep track of actual position</span>
<span style="color: #66d9ef">let</span> <span style="color: #f8f8f2">actualPositionWritable</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">SortedMap</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">DateTime</span><span style="color: #f92672">,</span><span style="color: #66d9ef">float</span><span style="color: #f92672">&gt;</span><span style="color: #f8f8f2">()</span>
<span style="color: #66d9ef">let</span> <span style="color: #f8f8f2">realTrades</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">SortedMap</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">DateTime</span><span style="color: #f92672">,</span><span style="color: #66d9ef">float</span><span style="color: #f92672">&gt;</span><span style="color: #f8f8f2">()</span> 
<span style="color: #66d9ef">let</span> <span style="color: #f8f8f2">actualPosition</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">actualPositionWritable</span> <span style="color: #f92672">:&gt;</span> <span style="color: #f8f8f2">Series</span><span style="color: #f92672">&lt;_,_&gt;</span>
<span style="color: #f8f8f2">actualPosition</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Do</span><span style="color: #f92672">((</span><span style="color: #66d9ef">fun</span> <span style="color: #f8f8f2">k</span> <span style="color: #f8f8f2">v</span> <span style="color: #f92672">-&gt;</span> 
    <span style="color: #f8f8f2">Console.WriteLine</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;Actual position: &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">k</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">ToString()</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot; : &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">v</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">ToString()</span><span style="color: #f92672">)</span>
  <span style="color: #f92672">),</span> <span style="color: #f8f8f2">ct</span><span style="color: #f92672">)</span>
</pre></div>

<p>Then we could feed our target position to a trader. The trader is &ldquo;functional&rdquo;, instead of receiving orders it receives the desired state and does its best to move actual state to the desired state. Here for simplicity, we have a very dangerous assumption that trades are executed  immediately after a signal. Such an assumption should be avoided in real world backtesting. We use the <em>Do()</em> extension method that invokes an action over each key/value in a series sequentially:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">targetPosition</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Do</span><span style="color: #f92672">(</span>
  <span style="color: #f92672">(</span><span style="color: #66d9ef">fun</span> <span style="color: #f8f8f2">k</span> <span style="color: #f8f8f2">v</span> <span style="color: #f92672">-&gt;</span>
    <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">k</span> <span style="color: #f92672">&lt;=</span> <span style="color: #f8f8f2">DateTime.UtcNow.AddMilliseconds</span><span style="color: #f92672">(-</span><span style="color: #ae81ff">400</span><span style="color: #f92672">.</span><span style="color: #ae81ff">0</span><span style="color: #f92672">)</span> <span style="color: #66d9ef">then</span>
      <span style="color: #75715e">// simulate historical trading</span>
      <span style="color: #66d9ef">let</span> <span style="color: #f8f8f2">qty</span> <span style="color: #f92672">=</span> 
        <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">actualPositionWritable</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">IsEmpty</span> <span style="color: #66d9ef">then</span> <span style="color: #f8f8f2">v</span>
        <span style="color: #66d9ef">else</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">v</span> <span style="color: #f92672">-</span> <span style="color: #f8f8f2">actualPositionWritable</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Last</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Value</span><span style="color: #f92672">)</span>
      <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">qty</span> <span style="color: #f92672">&lt;&gt;</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">.</span><span style="color: #ae81ff">0</span> <span style="color: #66d9ef">then</span>
        <span style="color: #f8f8f2">Console.WriteLine</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">k</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">ToString()</span> <span style="color: #f92672">+</span>  <span style="color: #e6db74">&quot; : Paper trade: &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">qty</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">ToString()</span><span style="color: #f92672">)</span>
        <span style="color: #f8f8f2">actualPositionWritable</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">AddLast</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">k</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">v</span><span style="color: #f92672">)</span>
    <span style="color: #66d9ef">else</span>
      <span style="color: #75715e">// do real trading</span>
      <span style="color: #66d9ef">let</span> <span style="color: #f8f8f2">qty</span> <span style="color: #f92672">=</span>
        <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">actualPositionWritable</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">IsEmpty</span> <span style="color: #66d9ef">then</span> <span style="color: #f8f8f2">failwith</span> <span style="color: #e6db74">&quot;must test strategy before real trading&quot;</span>
        <span style="color: #66d9ef">else</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">v</span> <span style="color: #f92672">-</span> <span style="color: #f8f8f2">actualPositionWritable</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Last</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Value</span><span style="color: #f92672">)</span>
      <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">qty</span> <span style="color: #f92672">&lt;&gt;</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">.</span><span style="color: #ae81ff">0</span> <span style="color: #f92672">&amp;&amp;</span> <span style="color: #f8f8f2">k</span> <span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">actualPositionWritable</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Last</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Key</span> <span style="color: #66d9ef">then</span> <span style="color: #75715e">// protect from executing history</span>
        <span style="color: #66d9ef">let</span> <span style="color: #f8f8f2">tradeTime</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">DateTime.UtcNow.AddMilliseconds</span><span style="color: #f92672">(</span><span style="color: #ae81ff">5</span><span style="color: #f92672">.</span><span style="color: #ae81ff">0</span><span style="color: #f92672">)</span>
        <span style="color: #f8f8f2">Console.WriteLine</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">tradeTime</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">ToString()</span> <span style="color: #f92672">+</span>  <span style="color: #e6db74">&quot; : Real trade: &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">qty</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">ToString()</span><span style="color: #f92672">)</span>
        <span style="color: #f8f8f2">realTrades</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">AddLast</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">tradeTime</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">qty</span><span style="color: #f92672">)</span>
        <span style="color: #f8f8f2">actualPositionWritable</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">AddLast</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">tradeTime</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">v</span><span style="color: #f92672">)</span>
  <span style="color: #f92672">),</span> <span style="color: #f8f8f2">ct</span><span style="color: #f92672">)</span>
</pre></div>

<p>Now the trading is started and we could see our trades in the FSI console every several seconds.</p>

<p>Finally, we calculate our P&amp;L. Because the market was trending by construction, we have earned a lot of money with this strategy:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">let</span> <span style="color: #f8f8f2">returns</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">quotes</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">ZipLag</span><span style="color: #f92672">(</span><span style="color: #ae81ff">1u</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">fun</span> <span style="color: #f8f8f2">c</span> <span style="color: #f8f8f2">p</span> <span style="color: #f92672">-&gt;</span> <span style="color: #f8f8f2">c</span><span style="color: #f92672">/</span><span style="color: #f8f8f2">p</span> <span style="color: #f92672">-</span> <span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #ae81ff">0</span><span style="color: #f92672">)</span>
<span style="color: #66d9ef">let</span> <span style="color: #f8f8f2">myReturns</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">actualPosition</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Repeat()</span> <span style="color: #f92672">*</span> <span style="color: #f8f8f2">returns</span>
<span style="color: #66d9ef">let</span> <span style="color: #f8f8f2">myAumIndex</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">myReturns</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Scan</span><span style="color: #f92672">(</span><span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #ae81ff">0</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">fun</span> <span style="color: #f8f8f2">st</span> <span style="color: #f8f8f2">k</span> <span style="color: #f8f8f2">v</span> <span style="color: #f92672">-&gt;</span> <span style="color: #f8f8f2">st</span><span style="color: #f92672">*(</span><span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #ae81ff">0</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">v</span><span style="color: #f92672">))</span>
</pre></div>

<p>Here, we use *ZipLag()* to calculate price returns. Then we calculate returns of our position and aggregate them as running product (no trading costs in this example). All these and above series are live, we could use the <em>Do()</em> method to print the values in real-time:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">// Print live data</span>
<span style="color: #f8f8f2">myAumIndex</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Do</span><span style="color: #f92672">((</span><span style="color: #66d9ef">fun</span> <span style="color: #f8f8f2">k</span> <span style="color: #f8f8f2">v</span> <span style="color: #f92672">-&gt;</span> 
    <span style="color: #f8f8f2">Console.WriteLine</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;AUM Index: &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">k</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">ToString()</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot; : &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">v</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">ToString()</span><span style="color: #f92672">)</span>
  <span style="color: #f92672">),</span> <span style="color: #f8f8f2">ct</span><span style="color: #f92672">)</span>
</pre></div>

<p>Note that from the technical point of view there is nothing special that links the calculations to financial markets. Instead of financial data, we could use data from some sensors, e.g. a temperature, and instead of trading, we could turn off/on heating if the temperature goes above or below some target value.</p>

<p>The whole example is <a href="https://github.com/Spreads/Spreads/blob/master/tests/Spreads.Tests.Profile/Example.fsx">here</a>. You could select all code, press Alt+Enter and watch how AUM increases while using Spreads library! :)</p>

</div>

        <footer class="post-footer clearfix">
    
        <p class="post-tags">
            <span>Tagged:</span>
            
                 <a href="/tags/markets/">markets</a>
            
                 <a href="/tags/spreads/">Spreads</a>
            
        </p>
    
</footer>

        
<div class="comments">
	<div id="disqus_thread"></div>
	<script type="text/javascript">
    var disqus_identifier = '84 http:\/\/hotforknowledge.com\/?p=84';
    
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        var disqus_shortname = 'hotforknowledge';
        
        
        
        
        if (window.location.hostname == "localhost")
            return;

        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
	<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
	<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

    </article>
</div>

            </div>
        </div>

        <footer class="footer">
            <div class="container">
                <div class="site-title-wrapper">
                    <h1 class="site-title">
                        <a title="Hot For Knowledge" href="http://hotforknowledge.com/">Hot For Knowledge</a>
                    </h1>
                    <a class="button-square" href="http://hotforknowledge.com/index.xml"><i class="fa fa-rss"></i></a>
                    <a name="footer"></a>
                    
                        <a class="button-square" title="&#xFEFF;Email&#xFEFF;" href="mailto:vbaybekov@gmail.com">
                            <i class="fa fa-envelope"></i>
                        </a>
                    
                    
                        <a class="button-square" title="&#xFEFF;Twitter&#xFEFF;" href="https://twitter.com/buybackoff/">
                            <i class="fa fa-twitter"></i>
                        </a>
                    
                    
                        <a class="button-square" title="&#xFEFF;Facebook&#xFEFF;" href="https://www.facebook.com/buybackoff/">
                            <i class="fa fa-facebook-official"></i>
                        </a>
                    
                    
                        <a class="button-square" title="&#xFEFF;Instagram&#xFEFF;" href="https://www.instagram.com/buybackoff/">
                            <i class="fa fa-instagram"></i>
                        </a>
                    
                    
                    
                        <a class="button-square" title="&#xFEFF;Github&#xFEFF;" href="https://github.com/buybackoff/">
                            <i class="fa fa-github-alt"></i>
                        </a>
                    
                    
                        <a class="button-square" title="&#xFEFF;Stack Overflow&#xFEFF;" href="http://stackoverflow.com/users/801189/v-b/">
                            <i class="fa fa-stack-overflow"></i>
                        </a>
                    
                    
                        <a class="button-square" title="&#xFEFF;LinkedIn&#xFEFF;" href="https://linkedin.com/in/buybackoff/">
                            <i class="fa fa-linkedin"></i>
                        </a>
                    
                    
                    
                    <a class="button-square button-jump-top js-jump-top" href="#" data-hint="Back to top" title="Back to top">
                        <i class="fa fa-angle-up"></i>
                    </a>&#xFEFF;
                </div>

                <p class="footer-copyright">
                    <span>&copy; 2016 Victor Baybekov </span>
                </p>
                
            </div>
        </footer>

        <script src="http://hotforknowledge.com/js/jquery-1.11.3.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script>
        <script src="http://hotforknowledge.com/js/jquery.fitvids.js"></script>
        <script src="http://hotforknowledge.com/js/scripts.js"></script>
    </body>
</html>

