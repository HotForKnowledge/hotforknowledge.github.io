<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">
    <head>
        
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-6ZL8ZK6ZPZ"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-6ZL8ZK6ZPZ');
        </script>

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Data Spreads: Write your Excel Macros In C# &middot; Victor Baybekov</title>
        <meta name="description" content="Replace VBA with modern C# for UDFs, macros and other Excel automation without Visual Studio">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="generator" content="Hugo 0.101.0" />
        <meta name="robots" content="index,follow">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta property="og:title" content="Data Spreads: Write your Excel Macros In C#">
<meta property="og:description" content="Replace VBA with modern C# for UDFs, macros and other Excel automation without Visual Studio">
<meta property="og:type" content="article">
<meta property="og:url" content="https://hotforknowledge.com/2016/10/31/5-data_spreads_excel_macros_in_csharp/">
        <link rel="stylesheet" href="/dist/site.css">
        <link rel="stylesheet" href="/dist/syntax.css">
        
        
            <link rel="stylesheet" href="/dist/toc.css">
        }}
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
        <link rel="icon" href="/favicon.png?v=1" />
        
        
        
        
        

    </head>
    <body>
        

	<div id="wrapper">
            <header class="site-header">
                <div class="container">
                    

                    <ul class="site-nav">
                        
    <li class="site-nav-item">
        <a href="/">Blog</a>
    </li>

    <li class="site-nav-item">
        <a href="/about">About</a>
    </li>

    <li class="site-nav-item">
        <a href="#footer">Contact</a>
    </li>


                    </ul>
                </div>
            </header>

            <div id="container">


<nav class="toc toc-left is-position-fixed"></nav>

<div class="container">
    
    <article class="post-container" itemscope="" itemtype="http://schema.org/BlogPosting">
        <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Data Spreads: Write your Excel Macros In C#</h1>
    
        <p class="post-description" itemprop="description">Replace VBA with modern C# for UDFs, macros and other Excel automation without Visual Studio</p>
    
    <p class="post-date post-line">
        <span>Published <time datetime="2016-10-31" itemprop="datePublished">Mon, Oct 31, 2016</time></span>
        <span>by</span>
        <span itemscope="" itemprop="author" itemtype="https://schema.org/Person">
            <span itemprop="name">
                <a href="https://twitter.com/buybackoff/" itemprop="url" rel="author">Victor Baybekov</a>
            </span>
        </span>
    </p>
    
</header>

        <div class="post-content clearfix" itemprop="articleBody">
    

    <p>A week ago, a friend of mine asked me if I could help him with parsing his old Excel
files containing orders of Christmas trees. It was his seasonal business every end of a year 
for a long time, and old orders back to 2006 were kept in quite a free form so that I myself 
as a human had difficulties to grasp the structure of the worksheets. However, the goal was 
to export the data into a CRM system, to identify clients who made regular orders and to call them and try selling trees this year as well.</p>
<p>I have been working on a desktop app that will integrate my <a href="https://github.com/Spreads/Spreads">Spreads</a> library,
Excel, R and .NET coding into a single real-time universe of data, called <a href="http://dataspreads.com/">Data Spreads</a>. This work is still in progress,
but the Christmas trees story forced me to pack at least the scripting feature I had 
and distribute it to my friend. So that instead of repacking an XLL add-in every time
on my side, I could send him a C# script as a text file and interactively (e.g. via a remote desktop) adjust its behavior if needed.</p>
<p>The scripting feature was &ldquo;nice to have&rdquo; initially for <em>Data Spreads</em>. I started playing with the <a href="https://github.com/lukebuehler/CShell">CShell</a>,
but it was rather overloaded from GUI and internal modular architecture perspectives, yet the editing experience 
was not very great compared to what Visual Studio or VS Code offers. Then I stumbled upon
<a href="https://github.com/aelij/RoslynPad">RoslynPad</a>, and it surprised me with its elegant simplicity and very pleasant editing experience powered
by Roslyn. At some point, I found myself keeping it open for writing small snippets and using it 
instead of the heavyweight VS for quick data parsing and similar tasks. 
Integrating RoslynPad with Excel was quite easy with another great
open-source library <a href="https://github.com/Excel-DNA/ExcelDna">ExcelDna</a>. All I had to do
was to rewrite the RP hosting functionality to run in the same process and AppDomain where Excel add-in runs,
and hook up some events to register UDFs and macros marked with the relevant ExcelDna attributes. 
Then it just worked(TM)☺</p>
<h1 id="christmas-trees-order-parsing">Christmas trees order parsing</h1>
<p>Humans were entering the orders in plain Excel, without any common format of addresses or phone numbers even 
on the same worksheet. Therefore, the task of correctly extracting the addresses and names looked like a 
machine learning task. However, the business task was extracting the phone numbers, connecting related orders,
and making an aggregate statistics by items and success status. In addition, it turned out that humans from a call center
would be calling to the clients, and in every particular case they could easily read the address and confirm
with the client if it is still valid. The entire parsing task reduced to extracting phone numbers, order dates and 
success statuses - the three things that couldn&rsquo;t be done easily with Excel formulas and required some coding.</p>
<p><img src="/img/christmas_trees/orders_sample_2006.png#aboutimage" alt="Orders sample 2006"></p>
<h4 id="phone-numbers">Phone numbers</h4>
<p>Moscow had optional phone prefix until recently, so the seven-digit numbers are <code>+7 495 XXX XX XX</code> now. The long-distance
prefix <code>8</code> is optional, and by international standard should be <code>+7</code>. The usage of dashes, dots, parentheses and spaces 
was non-standard inside each sheet. To deal with this, I wrote a simple <code>Sloppy Digit Pattern</code> RegEx:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-CSharp" data-lang="CSharp"><span class="line"><span class="ln" id="hl-0-1"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-0-1">1</a></span><span class="cl"><span class="c1">// SloppyDigitPattern: Since human entered text in a free form, we assume spaces between digits in any place (fat fingers)</span>
</span></span><span class="line"><span class="ln" id="hl-0-2"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-0-2">2</a></span><span class="cl"><span class="c1">// and very optional use of punctuation, e.g. &#39;-&#39;, &#39;.&#39;    </span>
</span></span><span class="line"><span class="ln" id="hl-0-3"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-0-3">3</a></span><span class="cl"><span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="n">sdp</span> <span class="p">=</span> <span class="s">@&#34;([\+-.\(]?\s*\d\s*[\)]?)&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln" id="hl-0-4"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-0-4">4</a></span><span class="cl"><span class="k">public</span> <span class="k">static</span> <span class="n">Regex</span> <span class="n">phoneRegex</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Regex</span><span class="p">(</span><span class="s">$@&#34;({sdp}{{7,11}})&#34;</span><span class="p">);</span>
</span></span></code></pre></div><p>Then a simple function returns all found phone numbers in the format that the CRM system supports:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-CSharp" data-lang="CSharp"><span class="line"><span class="ln" id="hl-1-1"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-1"> 1</a></span><span class="cl"><span class="k">public</span> <span class="k">static</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">Parser</span>
</span></span><span class="line"><span class="ln" id="hl-1-2"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-2"> 2</a></span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln" id="hl-1-3"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-3"> 3</a></span><span class="cl">    <span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="n">Phones</span><span class="p">(</span><span class="kt">string</span> <span class="k">value</span><span class="p">)</span>
</span></span><span class="line"><span class="ln" id="hl-1-4"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-4"> 4</a></span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln" id="hl-1-5"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-5"> 5</a></span><span class="cl">        <span class="k">return</span> <span class="n">phoneRegex</span><span class="p">.</span><span class="n">Matches</span><span class="p">(</span><span class="k">value</span><span class="p">)</span>
</span></span><span class="line"><span class="ln" id="hl-1-6"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-6"> 6</a></span><span class="cl">            <span class="p">.</span><span class="n">Cast</span><span class="p">&lt;</span><span class="n">Match</span><span class="p">&gt;().</span><span class="n">Select</span><span class="p">(</span><span class="n">m</span> <span class="p">=&gt;</span> <span class="n">m</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span>
</span></span><span class="line"><span class="ln" id="hl-1-7"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-7"> 7</a></span><span class="cl">            <span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">str</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="n">String</span><span class="p">(</span><span class="n">str</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">ch</span> <span class="p">=&gt;</span> <span class="n">Char</span><span class="p">.</span><span class="n">IsDigit</span><span class="p">(</span><span class="n">ch</span><span class="p">)).</span><span class="n">ToArray</span><span class="p">()))</span> <span class="c1">// keep only digits</span>
</span></span><span class="line"><span class="ln" id="hl-1-8"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-8"> 8</a></span><span class="cl">            <span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">number</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="ln" id="hl-1-9"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-9"> 9</a></span><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="ln" id="hl-1-10"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-10">10</a></span><span class="cl">                    <span class="k">if</span> <span class="p">(</span><span class="n">number</span><span class="p">.</span><span class="n">Length</span> <span class="p">==</span> <span class="m">11</span><span class="p">)</span>
</span></span><span class="line"><span class="ln" id="hl-1-11"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-11">11</a></span><span class="cl">                    <span class="p">{</span>
</span></span><span class="line"><span class="ln" id="hl-1-12"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-12">12</a></span><span class="cl">                        <span class="n">number</span> <span class="p">=</span> <span class="s">&#34;+7&#34;</span> <span class="p">+</span> <span class="n">number</span><span class="p">.</span><span class="n">Substring</span><span class="p">(</span><span class="m">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln" id="hl-1-13"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-13">13</a></span><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="ln" id="hl-1-14"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-14">14</a></span><span class="cl">                    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">number</span><span class="p">.</span><span class="n">Length</span> <span class="p">==</span> <span class="m">10</span><span class="p">)</span>
</span></span><span class="line"><span class="ln" id="hl-1-15"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-15">15</a></span><span class="cl">                    <span class="p">{</span>
</span></span><span class="line"><span class="ln" id="hl-1-16"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-16">16</a></span><span class="cl">                        <span class="n">number</span> <span class="p">=</span> <span class="s">&#34;+7&#34;</span> <span class="p">+</span> <span class="n">number</span><span class="p">;</span>
</span></span><span class="line"><span class="ln" id="hl-1-17"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-17">17</a></span><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="ln" id="hl-1-18"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-18">18</a></span><span class="cl">                    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">number</span><span class="p">.</span><span class="n">Length</span> <span class="p">==</span> <span class="m">7</span><span class="p">)</span>
</span></span><span class="line"><span class="ln" id="hl-1-19"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-19">19</a></span><span class="cl">                    <span class="p">{</span>
</span></span><span class="line"><span class="ln" id="hl-1-20"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-20">20</a></span><span class="cl">                        <span class="n">number</span> <span class="p">=</span> <span class="s">&#34;+7495&#34;</span> <span class="p">+</span> <span class="n">number</span><span class="p">;</span>
</span></span><span class="line"><span class="ln" id="hl-1-21"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-21">21</a></span><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="ln" id="hl-1-22"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-22">22</a></span><span class="cl">                    <span class="k">else</span>
</span></span><span class="line"><span class="ln" id="hl-1-23"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-23">23</a></span><span class="cl">                    <span class="p">{</span>
</span></span><span class="line"><span class="ln" id="hl-1-24"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-24">24</a></span><span class="cl">                        <span class="k">return</span> <span class="s">&#34;&#34;</span><span class="p">;</span> <span class="c1">// we only support 7, 10, and full 11 digit numbers</span>
</span></span><span class="line"><span class="ln" id="hl-1-25"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-25">25</a></span><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="ln" id="hl-1-26"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-26">26</a></span><span class="cl">        
</span></span><span class="line"><span class="ln" id="hl-1-27"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-27">27</a></span><span class="cl">                    <span class="k">return</span> <span class="n">number</span><span class="p">;</span>
</span></span><span class="line"><span class="ln" id="hl-1-28"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-28">28</a></span><span class="cl">                <span class="p">})</span>
</span></span><span class="line"><span class="ln" id="hl-1-29"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-29">29</a></span><span class="cl">            <span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="p">!</span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrWhiteSpace</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span></span><span class="line"><span class="ln" id="hl-1-30"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-30">30</a></span><span class="cl">            <span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">number</span> <span class="p">=&gt;</span> <span class="n">number</span><span class="p">.</span><span class="n">Insert</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="s">&#34; &#34;</span><span class="p">).</span><span class="n">Insert</span><span class="p">(</span><span class="m">6</span><span class="p">,</span> <span class="s">&#34; &#34;</span><span class="p">).</span><span class="n">Insert</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="s">&#34; &#34;</span><span class="p">).</span><span class="n">Insert</span><span class="p">(</span><span class="m">13</span><span class="p">,</span> <span class="s">&#34; &#34;</span><span class="p">))</span> <span class="c1">// comment to remove spaces</span>
</span></span><span class="line"><span class="ln" id="hl-1-31"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-31">31</a></span><span class="cl">            <span class="p">.</span><span class="n">Aggregate</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="p">(</span><span class="n">acc</span><span class="p">,</span> <span class="n">st</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">acc</span> <span class="p">+</span> <span class="s">&#34;[ &#34;</span> <span class="p">+</span> <span class="n">st</span> <span class="p">+</span> <span class="s">&#34; ] &#34;</span><span class="p">).</span><span class="n">Trim</span><span class="p">();</span>
</span></span><span class="line"><span class="ln" id="hl-1-32"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-32">32</a></span><span class="cl">
</span></span><span class="line"><span class="ln" id="hl-1-33"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-33">33</a></span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln" id="hl-1-34"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-34">34</a></span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Finally, we wrap the static method in another method that is marked with ExcelDna&rsquo;s <code>ExcelFunction</code> attribute.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-CSharp" data-lang="CSharp"><span class="line"><span class="ln" id="hl-2-1"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-2-1">1</a></span><span class="cl"><span class="k">const</span> <span class="kt">bool</span> <span class="n">defaultVolatile</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="ln" id="hl-2-2"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-2-2">2</a></span><span class="cl"><span class="na">
</span></span></span><span class="line"><span class="ln" id="hl-2-3"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-2-3">3</a></span><span class="cl"><span class="na">[ExcelFunction(IsVolatile = defaultVolatile)]</span>
</span></span><span class="line"><span class="ln" id="hl-2-4"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-2-4">4</a></span><span class="cl"><span class="k">public</span> <span class="k">static</span> <span class="kt">object</span> <span class="n">ParsePhone</span><span class="p">(</span><span class="kt">string</span> <span class="n">input</span> <span class="p">=</span> <span class="s">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln" id="hl-2-5"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-2-5">5</a></span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln" id="hl-2-6"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-2-6">6</a></span><span class="cl">    <span class="k">return</span> <span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrWhiteSpace</span><span class="p">(</span><span class="n">input</span><span class="p">)</span> <span class="p">?</span> <span class="s">&#34;&#34;</span> <span class="p">:</span> <span class="n">Parser</span><span class="p">.</span><span class="n">Phones</span><span class="p">(</span><span class="n">input</span><span class="p">);</span>
</span></span><span class="line"><span class="ln" id="hl-2-7"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-2-7">7</a></span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Now after running the script (<code>F5</code>) we have the function <code>ParsePhone</code> available from Excel or could debug it directly from
the script editor. The editor pretty-prints the last variable in a script (placed without semicolon), or any variable using
the <code>Dump()</code> extension method, e.g. <code>matches.Dump();</code>. Interestingly, the <code>Dump</code> method works when a function is called from Excel 
and prints variables in the same way, which is nice for debugging.</p>
<p><img src="/img/christmas_trees/debug_dump.png#aboutimage" alt="Debug dump"></p>
<h4 id="delivery-date">Delivery date</h4>
<p>Delivery dates were put as a header, once per day and not per order, e.g. <code>на 08.12.07г. , суббота</code> on the picture. 
Instead of writing C# code that will do something like &ldquo;for every row where the address and quantity are not empty,
move above until the quantity is empty, parse the cell in the same column as addresses, and for those orders apply that parsed date&rdquo;,
I wrote that logic using Excel functions. The task became very similar to phone parsing:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-CSharp" data-lang="CSharp"><span class="line"><span class="ln" id="hl-3-1"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-1"> 1</a></span><span class="cl"><span class="k">public</span> <span class="k">static</span> <span class="n">Regex</span> <span class="n">deliveryDateRegex</span> <span class="p">=</span> 
</span></span><span class="line"><span class="ln" id="hl-3-2"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-2"> 2</a></span><span class="cl">    <span class="k">new</span> <span class="n">Regex</span><span class="p">(</span><span class="s">@&#34;(?&lt;date&gt;\d{1,4})(\s*[.]?\s*)(?&lt;month&gt;(\d{1,4}|\p{L}+))(\s*[.]?\s*)?(?&lt;year&gt;\d{1,4})?&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln" id="hl-3-3"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-3"> 3</a></span><span class="cl">
</span></span><span class="line"><span class="ln" id="hl-3-4"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-4"> 4</a></span><span class="cl"><span class="k">public</span> <span class="k">static</span> <span class="n">DateTime</span><span class="p">?</span> <span class="n">DeliveryDate</span><span class="p">(</span><span class="kt">string</span> <span class="k">value</span><span class="p">,</span> <span class="kt">int</span> <span class="n">year</span> <span class="p">=</span> <span class="m">0</span><span class="p">)</span>
</span></span><span class="line"><span class="ln" id="hl-3-5"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-5"> 5</a></span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln" id="hl-3-6"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-6"> 6</a></span><span class="cl">    <span class="k">try</span>
</span></span><span class="line"><span class="ln" id="hl-3-7"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-7"> 7</a></span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln" id="hl-3-8"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-8"> 8</a></span><span class="cl">        <span class="kt">var</span> <span class="n">match</span> <span class="p">=</span> <span class="n">deliveryDateRegex</span><span class="p">.</span><span class="n">Matches</span><span class="p">(</span><span class="k">value</span><span class="p">).</span><span class="n">Cast</span><span class="p">&lt;</span><span class="n">Match</span><span class="p">&gt;().</span><span class="n">First</span><span class="p">();</span>
</span></span><span class="line"><span class="ln" id="hl-3-9"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-9"> 9</a></span><span class="cl">        <span class="kt">var</span> <span class="n">date</span> <span class="p">=</span> <span class="kt">int</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">match</span><span class="p">.</span><span class="n">Groups</span><span class="p">[</span><span class="s">&#34;date&#34;</span><span class="p">].</span><span class="n">Value</span><span class="p">);</span>
</span></span><span class="line"><span class="ln" id="hl-3-10"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-10">10</a></span><span class="cl">        <span class="c1">//date.Dump(&#34;date&#34;);</span>
</span></span><span class="line"><span class="ln" id="hl-3-11"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-11">11</a></span><span class="cl">        <span class="kt">var</span> <span class="n">monthString</span> <span class="p">=</span> <span class="n">match</span><span class="p">.</span><span class="n">Groups</span><span class="p">[</span><span class="s">&#34;month&#34;</span><span class="p">].</span><span class="n">Value</span><span class="p">;</span>
</span></span><span class="line"><span class="ln" id="hl-3-12"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-12">12</a></span><span class="cl">        <span class="kt">int</span> <span class="n">month</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln" id="hl-3-13"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-13">13</a></span><span class="cl">        <span class="k">if</span> <span class="p">(!</span><span class="kt">int</span><span class="p">.</span><span class="n">TryParse</span><span class="p">(</span><span class="n">monthString</span><span class="p">,</span> <span class="k">out</span> <span class="n">month</span><span class="p">))</span>
</span></span><span class="line"><span class="ln" id="hl-3-14"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-14">14</a></span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln" id="hl-3-15"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-15">15</a></span><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">monthString</span><span class="p">.</span><span class="n">ToLowerInvariant</span><span class="p">().</span><span class="n">Contains</span><span class="p">(</span><span class="s">&#34;дек&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="ln" id="hl-3-16"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-16">16</a></span><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="ln" id="hl-3-17"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-17">17</a></span><span class="cl">                <span class="n">month</span> <span class="p">=</span> <span class="m">12</span><span class="p">;</span>
</span></span><span class="line"><span class="ln" id="hl-3-18"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-18">18</a></span><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="ln" id="hl-3-19"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-19">19</a></span><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">monthString</span><span class="p">.</span><span class="n">ToLowerInvariant</span><span class="p">().</span><span class="n">Contains</span><span class="p">(</span><span class="s">&#34;ноя&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="ln" id="hl-3-20"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-20">20</a></span><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="ln" id="hl-3-21"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-21">21</a></span><span class="cl">                <span class="n">month</span> <span class="p">=</span> <span class="m">11</span><span class="p">;</span>
</span></span><span class="line"><span class="ln" id="hl-3-22"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-22">22</a></span><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="ln" id="hl-3-23"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-23">23</a></span><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">monthString</span><span class="p">.</span><span class="n">ToLowerInvariant</span><span class="p">().</span><span class="n">Contains</span><span class="p">(</span><span class="s">&#34;окт&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="ln" id="hl-3-24"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-24">24</a></span><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="ln" id="hl-3-25"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-25">25</a></span><span class="cl">                <span class="n">month</span> <span class="p">=</span> <span class="m">10</span><span class="p">;</span>
</span></span><span class="line"><span class="ln" id="hl-3-26"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-26">26</a></span><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="ln" id="hl-3-27"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-27">27</a></span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln" id="hl-3-28"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-28">28</a></span><span class="cl">        <span class="c1">//month.Dump(&#34;month&#34;);</span>
</span></span><span class="line"><span class="ln" id="hl-3-29"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-29">29</a></span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">month</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span> <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
</span></span><span class="line"><span class="ln" id="hl-3-30"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-30">30</a></span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">year</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span> <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
</span></span><span class="line"><span class="ln" id="hl-3-31"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-31">31</a></span><span class="cl">        <span class="c1">//year.Dump(&#34;year&#34;);</span>
</span></span><span class="line"><span class="ln" id="hl-3-32"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-32">32</a></span><span class="cl">        <span class="kt">var</span> <span class="n">dt</span> <span class="p">=</span> <span class="k">new</span> <span class="n">DateTime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">date</span><span class="p">);</span>
</span></span><span class="line"><span class="ln" id="hl-3-33"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-33">33</a></span><span class="cl">        <span class="k">return</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="ln" id="hl-3-34"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-34">34</a></span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln" id="hl-3-35"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-35">35</a></span><span class="cl">    <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span><span class="p">)</span>
</span></span><span class="line"><span class="ln" id="hl-3-36"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-36">36</a></span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln" id="hl-3-37"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-37">37</a></span><span class="cl">        <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
</span></span><span class="line"><span class="ln" id="hl-3-38"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-38">38</a></span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln" id="hl-3-39"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-39">39</a></span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln" id="hl-3-40"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-40">40</a></span><span class="cl"><span class="na">
</span></span></span><span class="line"><span class="ln" id="hl-3-41"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-41">41</a></span><span class="cl"><span class="na">[ExcelFunction(IsVolatile = defaultVolatile)]</span>
</span></span><span class="line"><span class="ln" id="hl-3-42"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-42">42</a></span><span class="cl"><span class="k">public</span> <span class="k">static</span> <span class="kt">object</span> <span class="n">ParseDeliveryDate</span><span class="p">(</span><span class="kt">string</span> <span class="n">input</span><span class="p">,</span> <span class="kt">int</span> <span class="n">year</span> <span class="p">=</span> <span class="m">0</span><span class="p">)</span>
</span></span><span class="line"><span class="ln" id="hl-3-43"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-43">43</a></span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln" id="hl-3-44"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-44">44</a></span><span class="cl">    <span class="kt">var</span> <span class="n">dt</span> <span class="p">=</span> <span class="n">Parser</span><span class="p">.</span><span class="n">DeliveryDate</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="n">year</span><span class="p">);</span>
</span></span><span class="line"><span class="ln" id="hl-3-45"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-45">45</a></span><span class="cl">    <span class="k">return</span> <span class="n">dt</span> <span class="p">==</span> <span class="k">null</span> <span class="p">?</span> <span class="p">(</span><span class="kt">object</span><span class="p">)</span><span class="s">&#34;&#34;</span> <span class="p">:</span> <span class="n">dt</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">ToOADate</span><span class="p">();</span>
</span></span><span class="line"><span class="ln" id="hl-3-46"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-3-46">46</a></span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h4 id="order-status">Order status</h4>
<p>Order status is determined by background or font color. The simple rule is that when 
any of those colors have <code>R</code> value greater that <code>G</code> value in the <code>RGB</code> representation, the order
status is unsuccessful.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-CSharp" data-lang="CSharp"><span class="line"><span class="ln" id="hl-4-1"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-4-1"> 1</a></span><span class="cl"><span class="err">#</span><span class="n">r</span> <span class="s">&#34;System.Drawing&#34;</span>
</span></span><span class="line"><span class="ln" id="hl-4-2"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-4-2"> 2</a></span><span class="cl">
</span></span><span class="line"><span class="ln" id="hl-4-3"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-4-3"> 3</a></span><span class="cl"><span class="k">using</span> <span class="nn">ExcelDna.Integration</span><span class="p">;</span>
</span></span><span class="line"><span class="ln" id="hl-4-4"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-4-4"> 4</a></span><span class="cl"><span class="k">using</span> <span class="nn">Microsoft.Office.Interop.Excel</span><span class="p">;</span>
</span></span><span class="line"><span class="ln" id="hl-4-5"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-4-5"> 5</a></span><span class="cl">
</span></span><span class="line"><span class="ln" id="hl-4-6"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-4-6"> 6</a></span><span class="cl"><span class="k">public</span> <span class="k">static</span> <span class="n">Range</span> <span class="n">ReferenceToRange</span><span class="p">(</span><span class="n">ExcelReference</span> <span class="n">xlRef</span><span class="p">)</span>
</span></span><span class="line"><span class="ln" id="hl-4-7"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-4-7"> 7</a></span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln" id="hl-4-8"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-4-8"> 8</a></span><span class="cl">    <span class="kt">var</span> <span class="n">xlRange</span> <span class="p">=</span> <span class="p">(</span><span class="n">ExcelDnaUtil</span><span class="p">.</span><span class="n">Application</span> <span class="k">as</span> <span class="n">Application</span><span class="p">).</span><span class="n">Evaluate</span><span class="p">(</span><span class="n">XlCall</span><span class="p">.</span><span class="n">Excel</span><span class="p">(</span><span class="n">XlCall</span><span class="p">.</span><span class="n">xlfReftext</span><span class="p">,</span> <span class="n">xlRef</span><span class="p">,</span> <span class="k">true</span><span class="p">))</span> <span class="k">as</span> <span class="n">Range</span><span class="p">;</span>
</span></span><span class="line"><span class="ln" id="hl-4-9"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-4-9"> 9</a></span><span class="cl">    <span class="k">return</span> <span class="n">xlRange</span><span class="p">;</span>
</span></span><span class="line"><span class="ln" id="hl-4-10"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-4-10">10</a></span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln" id="hl-4-11"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-4-11">11</a></span><span class="cl"><span class="na">
</span></span></span><span class="line"><span class="ln" id="hl-4-12"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-4-12">12</a></span><span class="cl"><span class="na">[ExcelFunction(IsVolatile = defaultVolatile, IsMacroType = true)]</span>
</span></span><span class="line"><span class="ln" id="hl-4-13"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-4-13">13</a></span><span class="cl"><span class="k">public</span> <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">Status</span><span class="p">([</span><span class="n">ExcelArgument</span><span class="p">(</span><span class="n">AllowReference</span> <span class="p">=</span> <span class="k">true</span><span class="p">)]</span><span class="kt">object</span> <span class="n">input</span><span class="p">)</span>
</span></span><span class="line"><span class="ln" id="hl-4-14"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-4-14">14</a></span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln" id="hl-4-15"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-4-15">15</a></span><span class="cl">    <span class="kt">var</span> <span class="n">xlRef</span> <span class="p">=</span> <span class="n">input</span> <span class="k">as</span> <span class="n">ExcelReference</span><span class="p">;</span>
</span></span><span class="line"><span class="ln" id="hl-4-16"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-4-16">16</a></span><span class="cl">    <span class="kt">var</span> <span class="n">rng</span> <span class="p">=</span> <span class="n">ReferenceToRange</span><span class="p">(</span><span class="n">xlRef</span><span class="p">);</span>
</span></span><span class="line"><span class="ln" id="hl-4-17"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-4-17">17</a></span><span class="cl">    <span class="k">try</span>
</span></span><span class="line"><span class="ln" id="hl-4-18"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-4-18">18</a></span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln" id="hl-4-19"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-4-19">19</a></span><span class="cl">        <span class="kt">var</span> <span class="n">oleColor</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="kt">double</span><span class="p">)</span><span class="n">rng</span><span class="p">.</span><span class="n">Interior</span><span class="p">.</span><span class="n">Color</span><span class="p">;</span>
</span></span><span class="line"><span class="ln" id="hl-4-20"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-4-20">20</a></span><span class="cl">        <span class="c1">//oleColor.Dump();</span>
</span></span><span class="line"><span class="ln" id="hl-4-21"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-4-21">21</a></span><span class="cl">        <span class="kt">var</span> <span class="n">color</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">Drawing</span><span class="p">.</span><span class="n">ColorTranslator</span><span class="p">.</span><span class="n">FromOle</span><span class="p">(</span><span class="n">oleColor</span><span class="p">);</span>
</span></span><span class="line"><span class="ln" id="hl-4-22"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-4-22">22</a></span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">color</span><span class="p">.</span><span class="n">R</span> <span class="p">&gt;</span> <span class="n">color</span><span class="p">.</span><span class="n">G</span><span class="p">)</span> <span class="k">return</span> <span class="m">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln" id="hl-4-23"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-4-23">23</a></span><span class="cl">        <span class="n">oleColor</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="kt">double</span><span class="p">)</span><span class="n">rng</span><span class="p">.</span><span class="n">Font</span><span class="p">.</span><span class="n">Color</span><span class="p">;</span>
</span></span><span class="line"><span class="ln" id="hl-4-24"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-4-24">24</a></span><span class="cl">        <span class="n">color</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">Drawing</span><span class="p">.</span><span class="n">ColorTranslator</span><span class="p">.</span><span class="n">FromOle</span><span class="p">(</span><span class="n">oleColor</span><span class="p">);</span>
</span></span><span class="line"><span class="ln" id="hl-4-25"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-4-25">25</a></span><span class="cl">        <span class="k">return</span> <span class="p">(</span><span class="n">color</span><span class="p">.</span><span class="n">R</span> <span class="p">&gt;</span> <span class="n">color</span><span class="p">.</span><span class="n">G</span><span class="p">)</span> <span class="p">?</span> <span class="m">0</span> <span class="p">:</span> <span class="m">1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln" id="hl-4-26"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-4-26">26</a></span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln" id="hl-4-27"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-4-27">27</a></span><span class="cl">    <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span><span class="p">)</span>
</span></span><span class="line"><span class="ln" id="hl-4-28"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-4-28">28</a></span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln" id="hl-4-29"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-4-29">29</a></span><span class="cl">        <span class="k">return</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln" id="hl-4-30"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-4-30">30</a></span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln" id="hl-4-31"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-4-31">31</a></span><span class="cl">    <span class="k">finally</span>
</span></span><span class="line"><span class="ln" id="hl-4-32"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-4-32">32</a></span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln" id="hl-4-33"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-4-33">33</a></span><span class="cl">        <span class="n">Marshal</span><span class="p">.</span><span class="n">ReleaseComObject</span><span class="p">(</span><span class="n">rng</span><span class="p">);</span>
</span></span><span class="line"><span class="ln" id="hl-4-34"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-4-34">34</a></span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln" id="hl-4-35"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-4-35">35</a></span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Here we use COM interop and <code>Microsoft.Office.Interop.Excel</code> namespace to get the COM <code>Range</code> object
from ExcelDna&rsquo;s <code>ExcelReference</code> object, and then convert OLE colors to RGB ones using the 
<code>System.Drawing.ColorTranslator.FromOle</code> method. Note the usage of <code>Marshal.ReleaseComObject</code> for COM 
objects here: it is a good practice to use this method whenever user code received or created a COM object
and no longer needs it (more on this in the next section).
<img src="/img/christmas_trees/status.png#aboutimage" alt="Status formula"></p>
<h1 id="excel-model-and-xlresult">Excel Model and XlResult</h1>
<p>While quickly writing the parsing code above, I made a very common mistake that I was aware of,
but still assigned a COM object to a static field and did not release a reference to it. That issue is described 
in details in <a href="http://stackoverflow.com/questions/158706/how-to-properly-clean-up-excel-interop-objects?noredirect=1&amp;lq=1">this SO question</a>.
The simple rule of thumb is to never ever call C or COM Excel API outside of the main thread,
never use 2 dots with com objects, do not 
store COM objects for longer than they are needed and always release them with <code>Marshal.ReleaseComObject</code>.</p>
<p>ExcelDna has a helper method to schedule any action on the main thread, but it doesn&rsquo;t return a value. Also,
if one uses the method when already on the main thread and tries to wait for a result using a wait handle or 
a TaskComletionSource, there will be a deadlock. Always following the rules in a safe way requires 
repeating the same boilerplate code, and I wrote a helper class that works similarly to <code>Task</code>, but always 
executes on the main Excel thread, is awaitable from C# <code>async</code> methods using the <code>await</code> keyword, supports
composition of functions and adds very little overheads. The code is quite long to place it here inline and is available
on <a href="https://github.com/DataSpreads/ExcelModel/blob/master/src/DataSpreads.ExcelModel/XlResult.cs">GitHub</a>. 
The main work happens in the  <a href="https://github.com/DataSpreads/ExcelModel/blob/master/src/DataSpreads.ExcelModel/XlResult.cs#L80"><code>GetResult</code> method</a>.</p>
<p>We then could rewrite the Status example above using <code>XlResult</code> and <code>await</code> keyword. C# could <a href="https://blogs.msdn.microsoft.com/pfxteam/2011/01/13/await-anything/">await anything</a> 
that has <code>GetAwaiter</code> method, and we just use <a href="https://github.com/DataSpreads/ExcelModel/blob/master/src/DataSpreads.ExcelModel/XlResult.cs#L113"><code>TaskComletionSource.Task</code></a> for this.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-CSharp" data-lang="CSharp"><span class="line"><span class="ln" id="hl-5-1"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-5-1"> 1</a></span><span class="cl">
</span></span><span class="line"><span class="ln" id="hl-5-2"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-5-2"> 2</a></span><span class="cl"><span class="k">public</span> <span class="k">static</span> <span class="n">XlResult</span><span class="p">&lt;</span><span class="n">Range</span><span class="p">&gt;</span> <span class="n">ReferenceToRange</span><span class="p">(</span><span class="n">ExcelReference</span> <span class="n">xlRef</span><span class="p">)</span>
</span></span><span class="line"><span class="ln" id="hl-5-3"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-5-3"> 3</a></span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln" id="hl-5-4"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-5-4"> 4</a></span><span class="cl">    <span class="kt">var</span> <span class="n">xlRange</span> <span class="p">=</span> <span class="k">new</span> <span class="n">XlResult</span><span class="p">&lt;</span><span class="n">Range</span><span class="p">&gt;(()</span> <span class="p">=&gt;</span> <span class="p">(</span><span class="n">ExcelDnaUtil</span><span class="p">.</span><span class="n">Application</span> <span class="k">as</span> <span class="n">Application</span><span class="p">).</span><span class="n">Evaluate</span><span class="p">(</span><span class="n">XlCall</span><span class="p">.</span><span class="n">Excel</span><span class="p">(</span><span class="n">XlCall</span><span class="p">.</span><span class="n">xlfReftext</span><span class="p">,</span> <span class="n">xlRef</span><span class="p">,</span> <span class="k">true</span><span class="p">))</span> <span class="k">as</span> <span class="n">Range</span><span class="p">);</span>
</span></span><span class="line"><span class="ln" id="hl-5-5"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-5-5"> 5</a></span><span class="cl">    <span class="k">return</span> <span class="n">xlRange</span><span class="p">;</span>
</span></span><span class="line"><span class="ln" id="hl-5-6"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-5-6"> 6</a></span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln" id="hl-5-7"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-5-7"> 7</a></span><span class="cl"><span class="na">
</span></span></span><span class="line"><span class="ln" id="hl-5-8"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-5-8"> 8</a></span><span class="cl"><span class="na">[ExcelFunction(IsVolatile = defaultVolatile, IsMacroType = true)]</span>
</span></span><span class="line"><span class="ln" id="hl-5-9"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-5-9"> 9</a></span><span class="cl"><span class="k">public</span> <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">Status</span><span class="p">([</span><span class="n">ExcelArgument</span><span class="p">(</span><span class="n">AllowReference</span> <span class="p">=</span> <span class="k">true</span><span class="p">)]</span><span class="kt">object</span> <span class="n">input</span><span class="p">)</span>
</span></span><span class="line"><span class="ln" id="hl-5-10"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-5-10">10</a></span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln" id="hl-5-11"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-5-11">11</a></span><span class="cl">    <span class="kt">var</span> <span class="n">xlRef</span> <span class="p">=</span> <span class="n">input</span> <span class="k">as</span> <span class="n">ExcelReference</span><span class="p">;</span>
</span></span><span class="line"><span class="ln" id="hl-5-12"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-5-12">12</a></span><span class="cl">    <span class="c1">// we could await XlResult from any thread safely</span>
</span></span><span class="line"><span class="ln" id="hl-5-13"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-5-13">13</a></span><span class="cl">    <span class="kt">var</span> <span class="n">rng</span> <span class="p">=</span> <span class="k">await</span> <span class="n">ReferenceToRange</span><span class="p">(</span><span class="n">xlRef</span><span class="p">);</span>
</span></span><span class="line"><span class="ln" id="hl-5-14"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-5-14">14</a></span><span class="cl">    <span class="c1">// same code for Status...</span>
</span></span><span class="line"><span class="ln" id="hl-5-15"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-5-15">15</a></span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>The COM issue could quickly become nasty. At some point, I even wrote an F# computation expression
that did manual reference counting behind the scenes, but it didn&rsquo;t work reliably 100% of times.
Therefore, instead of reference counting, I added a <code>Map</code> method that could chain different functions together
and guarantee that COM objects and C/COM APIs are never accessed outside the main thread. E.g. in this 
example, we chain three functions:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-CSharp" data-lang="CSharp"><span class="line"><span class="ln" id="hl-6-1"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-6-1"> 1</a></span><span class="cl"><span class="na">[ExcelFunction(IsMacroType = true)]</span>
</span></span><span class="line"><span class="ln" id="hl-6-2"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-6-2"> 2</a></span><span class="cl"><span class="k">public</span> <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">Hello</span><span class="p">([</span><span class="n">ExcelArgument</span><span class="p">(</span><span class="n">AllowReference</span> <span class="p">=</span> <span class="k">true</span><span class="p">)]</span><span class="kt">object</span> <span class="n">text</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln" id="hl-6-3"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-6-3"> 3</a></span><span class="cl">    <span class="kt">var</span> <span class="n">xlRef</span> <span class="p">=</span> <span class="n">text</span> <span class="k">as</span> <span class="n">ExcelReference</span><span class="p">;</span>
</span></span><span class="line"><span class="ln" id="hl-6-4"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-6-4"> 4</a></span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">xlRef</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln" id="hl-6-5"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-6-5"> 5</a></span><span class="cl">        <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="n">XlResult</span><span class="p">.</span><span class="n">XlCall</span><span class="p">(</span><span class="n">XlCall</span><span class="p">.</span><span class="n">xlfReftext</span><span class="p">,</span> <span class="n">xlRef</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span>
</span></span><span class="line"><span class="ln" id="hl-6-6"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-6-6"> 6</a></span><span class="cl">            <span class="p">.</span><span class="n">Map</span><span class="p">(</span><span class="n">str</span> <span class="p">=&gt;</span> <span class="n">DSAddIn</span><span class="p">.</span><span class="n">XlApp</span><span class="p">.</span><span class="n">Evaluate</span><span class="p">((</span><span class="kt">string</span><span class="p">)</span><span class="n">str</span><span class="p">)</span> <span class="k">as</span> <span class="n">Range</span><span class="p">)</span>
</span></span><span class="line"><span class="ln" id="hl-6-7"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-6-7"> 7</a></span><span class="cl">            <span class="p">.</span><span class="n">Map</span><span class="p">(</span><span class="n">rng</span> <span class="p">=&gt;</span> <span class="n">rng</span><span class="p">.</span><span class="n">Value2</span><span class="p">.</span><span class="n">ToString</span><span class="p">()))</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln" id="hl-6-8"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-6-8"> 8</a></span><span class="cl">            <span class="k">return</span> <span class="k">await</span> <span class="n">result</span><span class="p">;</span>
</span></span><span class="line"><span class="ln" id="hl-6-9"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-6-9"> 9</a></span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln" id="hl-6-10"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-6-10">10</a></span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln" id="hl-6-11"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-6-11">11</a></span><span class="cl">    <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="p">();</span>
</span></span><span class="line"><span class="ln" id="hl-6-12"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-6-12">12</a></span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Accessing COM object and C API only from the main thread should work &ldquo;as expected&rdquo; even without
explicit releasing via <code>Marshal</code> methods, as was written somewhere on ExcelDna forum/mailing list (cannot find a link).
Using <code>XlResult</code> helps to stay on the main thread and follow the rules.</p>
<p>The <a href="https://github.com/DataSpreads/ExcelModel">ExcelModel</a> library also contains some code from GitHub, where 
the author tried to achieve the similar result - to avoid using COM objects while working with a similar 
object model. However, it is not thread-safe now and I will gradually rewrite frequently used methods
with the <code>XlResult</code> async pattern.</p>
<h1 id="install-and-usage">Install and usage</h1>
<p>To install the <em>Data Spreads</em> app, please download <a href="http://downloads.dataspreads.com/Setup.exe">Setup.exe</a> or 
<a href="http://downloads.dataspreads.com/Setup.msi">Setup.msi</a> files*, which are packed with <a href="https://github.com/Squirrel/Squirrel.Windows">Squirrel</a>
and will automatically update when I add new functionality. When the Setup process finishes, you will have 
a tray icon with three commands: <em>Excel Add-In</em>, which starts Excel and loads the add-in, <em>Script Editor</em>, which loads 
a standalone editor, and <em>Exit</em>.</p>
<p><img src="/img/christmas_trees/tray_icon.png#aboutimage" alt="Tray icon"></p>
<p>In Excel, you will have <em>Data Spreads</em> tab with a <em>Script Editor</em> button. You may find a basic self-explanatory
sample and the Christmas trees sample in the <code>Samples\Data Spreads\Excel</code> folder. An Excel file that actually uses the functions from the
Christmas sample is <a href="/excel/christmas_trees_sample.xlsx">here</a>.</p>
<p><img src="/img/christmas_trees/ribbon.png#aboutimage" alt="Ribbon"></p>
<p>If you get some error related to Excel version or bitness, you may find the <code>.xll</code> files in the 
<code>C:\Users\%USERNAME%\AppData\Local\DataSpreads\app-X.Y.Z\Excel</code> directory and start the one 
that corresponds to your Excel bitness (if you do not know it, just try both <code>DataSpreads[32/64].xll</code> until it works).</p>
<p>Below are the simplest user-defined functions that return the same <code>$&quot;Hello, {name}!&quot;</code> text. The difference 
is that the first one will block Excel UI during its execution, while the second one will return <code>#NA</code> until 
the async result is available but will keep the UI responsive. The async version is the best option 
for long-running functions with heavy calculations or IO operations, and could be easily used with awaitable <code>XlResult</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-CSharp" data-lang="CSharp"><span class="line"><span class="ln" id="hl-7-1"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-7-1"> 1</a></span><span class="cl"><span class="na">[ExcelFunction(IsVolatile = false, IsThreadSafe = true, IsClusterSafe = true, Name = &#34;Hello&#34;)]</span>
</span></span><span class="line"><span class="ln" id="hl-7-2"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-7-2"> 2</a></span><span class="cl"><span class="k">public</span> <span class="k">static</span> <span class="kt">object</span> <span class="n">Hello</span><span class="p">(</span>
</span></span><span class="line"><span class="ln" id="hl-7-3"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-7-3"> 3</a></span><span class="cl"><span class="na">[ExcelArgument(Name = &#34;NAME&#34;, AllowReference = true, Description = &#34;Name for greetings&#34;)]</span> <span class="kt">string</span> <span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="ln" id="hl-7-4"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-7-4"> 4</a></span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln" id="hl-7-5"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-7-5"> 5</a></span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrWhiteSpace</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="n">name</span> <span class="p">=</span> <span class="s">&#34;Data Spreads&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln" id="hl-7-6"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-7-6"> 6</a></span><span class="cl">    <span class="c1">// this will block Excel UI</span>
</span></span><span class="line"><span class="ln" id="hl-7-7"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-7-7"> 7</a></span><span class="cl">    <span class="n">Thread</span><span class="p">.</span><span class="n">Sleep</span><span class="p">(</span><span class="m">1000</span><span class="p">);</span>
</span></span><span class="line"><span class="ln" id="hl-7-8"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-7-8"> 8</a></span><span class="cl">    <span class="k">return</span> <span class="s">$&#34;Hello, {name}!&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln" id="hl-7-9"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-7-9"> 9</a></span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln" id="hl-7-10"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-7-10">10</a></span><span class="cl"><span class="na">
</span></span></span><span class="line"><span class="ln" id="hl-7-11"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-7-11">11</a></span><span class="cl"><span class="na">[ExcelFunction(IsVolatile = false, IsClusterSafe = true, Name = &#34;HelloAsync&#34;)]</span>
</span></span><span class="line"><span class="ln" id="hl-7-12"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-7-12">12</a></span><span class="cl"><span class="k">public</span> <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="kt">object</span><span class="p">&gt;</span> <span class="n">HelloAsync</span><span class="p">(</span>
</span></span><span class="line"><span class="ln" id="hl-7-13"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-7-13">13</a></span><span class="cl"><span class="na">[ExcelArgument(Name = &#34;NAME&#34;, AllowReference = true, Description = &#34;Name for greetings&#34;)]</span> <span class="kt">string</span> <span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="ln" id="hl-7-14"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-7-14">14</a></span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln" id="hl-7-15"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-7-15">15</a></span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrWhiteSpace</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="n">name</span> <span class="p">=</span> <span class="s">&#34;Data Spreads&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln" id="hl-7-16"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-7-16">16</a></span><span class="cl">    <span class="c1">// This will nicely return #NA and then the result after the delay, without blocking Excel UI</span>
</span></span><span class="line"><span class="ln" id="hl-7-17"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-7-17">17</a></span><span class="cl">    <span class="k">await</span> <span class="n">Task</span><span class="p">.</span><span class="n">Delay</span><span class="p">(</span><span class="m">1000</span><span class="p">);</span>
</span></span><span class="line"><span class="ln" id="hl-7-18"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-7-18">18</a></span><span class="cl">    <span class="k">return</span> <span class="s">$&#34;Hello, {name}!&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln" id="hl-7-19"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-7-19">19</a></span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Note the <code>IsThreadSafe = true</code> attribute parameter of the first function: when it is set to true the execution happens
not on the main thread but on a dedicated calculation thread; but the UI is still blocked. With <code>IsThreadSafe = false</code>, the function will always run on the
main thread, which could be seen by adding <code>Thread.CurrentThread.ManagedThreadId</code> to the return value. 
In the async case, the execution is never on the main thread but on a .NET thread-pool, and one should keep in mind the COM interop issues
and use the XlResult pattern when working with COM/C APIs.</p>
<h1 id="contributing--roadmap">Contributing &amp; roadmap</h1>
<p><a href="https://github.com/aelij/RoslynPad"><strong>RoslynPad</strong></a>: I made almost no changes to the RoslynPad core functionality - its <em>Common</em>, <em>Roslyn</em> and <em>RoslynEditor</em> <a href="https://github.com/aelij/RoslynPad/tree/master/src">projects</a> 
are practically unchanged. Therefore, all kudos and contributions related to the code editing experience 
should go to the <a href="https://github.com/aelij/RoslynPad">original project</a>.
My changes to hosting and GUI are very small and do not deserve a separate project; instead, I will try
to push them upstream.</p>
<p><a href="https://github.com/Excel-DNA/ExcelDna"><strong>ExcelDna</strong></a>: This is a very mature and well-documented project. The fact that I could use it from the script editor 
without any single change just proves its reliability. Please go to <a href="https://github.com/Excel-DNA/ExcelDna">its repo</a> for details.</p>
<p><a href="https://github.com/DataSpreads/ExcelModel/"><strong>ExcelModel</strong></a>: This is my small library for Excel utilities, with a goal to make a thread-safe API
using .NET types over Excel&rsquo;s C or COM API. Currently it contains <a href="https://github.com/DataSpreads/ExcelModel/blob/master/src/DataSpreads.ExcelModel/XlResult.cs"><code>XlResult&lt;TResult&gt;</code></a>
helper type that is described 
in the <em>Excel Model</em> section above, and some legacy code from GitHub. At first, I
will add data dumping features, such as charts and tables, and utility functions scattered among my private projects 
(such as <code>ReferenceToRange</code> in the samples above). This library is referenced from all scripts when the editor is started 
from Excel, will be updated frequently and is <em>open for any contributions</em>!</p>
<p>My current focus is on other features of <em>Data Spreads</em> project and I am happy that I checked the box with Script Editor.
I will continue to polish it and contribute to upstream repos, but it is already quite good for the real job of Excel scripting</p>
<ul>
<li>thanks to the awesome open-source libraries. I do no plan to charge anything for offline features of <em>Data Spreads</em> such as this Script Editor, while similar solutions
cost much more (and currently provide more features, e.g. <a href="http://fcell.io/">http://fcell.io/</a> costs $1k per annum). My goal is to 
make the standalone application useful for number crunching and data science even without internet connection. 
So please stay tuned and share your feedback and features you need the most!</li>
</ul>
<blockquote>
<p>P.S. If you are in Moscow and need a Christmas tree, don&rsquo;t think twice and just go to <a href="http://elki-shop.ru/">http://elki-shop.ru/</a>,
the shop has the best ones in the city and 10+ years track record with happy customers! ☺</p>
</blockquote>
<hr>
<blockquote>
<p>* THE SOFTWARE IS PROVIDED &ldquo;AS IS&rdquo;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.</p>
</blockquote>
<blockquote>
<p>The application is experimental work in progress, even though is already useful.</p>
</blockquote>

</div>

        <footer class="post-footer clearfix">
        <p class="post-tags">
            <span>Tagged:</span>
                <a href="/tags/excel/">Excel</a>, 
                <a href="/tags/dataspreads/">DataSpreads</a>
        </p>
    <div class="share">
            <a class="icon-twitter" href="https://twitter.com/share?text=Data%20Spreads%3a%20Write%20your%20Excel%20Macros%20In%20C%23&url=https%3a%2f%2fhotforknowledge.com%2f2016%2f10%2f31%2f5-data_spreads_excel_macros_in_csharp%2f"
                onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" aria-label="Share on Twitter">
                <i class="fa fa-twitter" aria-hidden="true"></i>
            </a>
            <a class="icon-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&title=Data%20Spreads%3a%20Write%20your%20Excel%20Macros%20In%20C%23&url=https%3a%2f%2fhotforknowledge.com%2f2016%2f10%2f31%2f5-data_spreads_excel_macros_in_csharp%2f&summary=Replace%20VBA%20with%20modern%20C%23%20for%20UDFs%2c%20macros%20and%20other%20Excel%20automation%20without%20Visual%20Studio"
               onclick="window.open(this.href, 'linkedin-share', 'width=554,height=481');return false;" aria-label="Share on LinkedIn">
               <i class="fa fa-linkedin" aria-hidden="true"></i>
            </a>
    </div>
</footer>

        
<div class="comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_identifier = 'https:\/\/hotforknowledge.com\/2016\/10\/31\/5-data_spreads_excel_macros_in_csharp\/';

        (function () {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            var disqus_shortname = 'hotforknowledge';
            

            
            
            if (window.location.hostname == "localhost")
                return;

            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
    <a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

    </article>
</div>

</div>
</div>

<footer class="footer">
    <div class="container">
        <div class="site-title-wrapper">
            <h1 class="site-title">
                        <a href="/">Hot For Knowledge</a>
            </h1>
                    <a class="button-square button-jump-top js-jump-top" href="#" aria-label="Back to Top">
                        <i class="fa fa-angle-up" aria-hidden="true"></i>
            <a class="button-square" href="/index.xml"><i class="fa fa-rss"></i></a>
            <a name="footer"></a>
            
            <a class="button-square" title="&#xFEFF;Email&#xFEFF;" href="mailto:blog@hotforknowledge.com">
                <i class="fa fa-envelope"></i>
            </a>
            
            
            <a class="button-square" title="&#xFEFF;Twitter&#xFEFF;" href="https://twitter.com/buybackoff/">
                <i class="fa fa-twitter"></i>
            </a>
            
            
            
            
            
            <a class="button-square" title="&#xFEFF;Github&#xFEFF;" href="https://github.com/buybackoff/">
                <i class="fa fa-github-alt"></i>
            </a>
            
            
            <a class="button-square" title="&#xFEFF;Stack Overflow&#xFEFF;" href="http://stackoverflow.com/users/801189/v-b/">
                <i class="fa fa-stack-overflow"></i>
            </a>
            
            
            <a class="button-square" title="&#xFEFF;LinkedIn&#xFEFF;" href="https://linkedin.com/in/buybackoff/">
                <i class="fa fa-linkedin"></i>
            </a>
            
            

            <a class="button-square button-jump-top js-jump-top" href="#" data-hint="Back to top" title="Back to top">
                <i class="fa fa-angle-up"></i>
            </a>
        </div>

        <p class="footer-copyright">
            <span>&copy; 2015-2024 Victor Baybekov </span>
        </p>
        <p class="footer-copyright">
            <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
                <img alt="Creative Commons License" style="border-width:0; margin: 0; padding: 0; display: inline;" src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" />
            </a>
        </p>
        <p class="footer-copyright">
            All content is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
        </p>
    </div>
</footer>

<script src="/js/jquery-1.11.3.min.js "></script>
<script src="/js/jquery.fitvids.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.11.1/tocbot.min.js"></script>
<script src="/js/scripts.js"></script>
        
</body>

</html>
